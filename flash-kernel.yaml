metadata:
   name: lava-deploy
   maintainer:
      - Michael Hudson-Doyle <michael.hudson@linaro.org>
   format: "Lava-Test-Shell Test Definition 1.0"
   version: 1.0
   description: ""
   os:
      - ubuntu
   devices:
      - mustang
   environment:
      - lava-test-shell


run:
  steps:
    - "set -x"
    - "set +e"
    - "mount /dev/sda1 /mnt"
    - "mv /mnt/etc/resolv.conf /mnt/etc/resolv.conf.bak"
    - "cp /etc/resolv.conf /mnt/etc/resolv.conf"
    - "mount -t proc procfs /mnt/proc"
    - "cp fk.sh /mnt/fk.sh"
    - "SDA1UUID=`ls /dev/disk/by-uuid`"
    - "sed -e 's/@SDA1UUID@/'${SDA1UUID}'/' boot.script > /mnt/boot/boot.script"
    - "cat /mnt/boot/boot.script"
    - "chroot /mnt bash -x /fk.sh"
    - "mv /mnt/etc/resolv.conf.bak /mnt/etc/resolv.conf"
