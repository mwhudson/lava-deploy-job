metadata:
   name: process-results
   maintainer:
      - Michael Hudson-Doyle <michael.hudson@linaro.org>
   format: "Lava-Test-Shell Test Definition 1.0"
   version: 1.0
   description: "Read the results of running tempest from /dev/sda and convert them to LAVA results."
   os:
      - ubuntu
   devices:
      - mustang
   environment:
      - lava-test-shell


run:
  steps:
    - "set -x"
    - "mount /dev/sda1 /mnt"
    - "set +e"
    - "cd /mnt/home/ubuntu/attachments"
    - "for f in *; do lava-test-run-attach $f; done"
    - "cd /mnt/opt/stack/tempest"
    - "tar -czf tr.tar.gz .testrepository"
    - "lava-test-run-attach tr.tar.gz"
    - "set +x"
    - "cat /mnt/home/ubuntu/attachments/results.txt | while read test result; do lava-test-case $test --result $result; done"
